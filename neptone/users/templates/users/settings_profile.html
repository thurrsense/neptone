{% extends "base.html" %}
{% load static %}
{% block title %}Settings ¬∑ NEPTONE{% endblock %}

{% block content %}
<div class="container py-3">

    <!-- Header -->
    <div class="d-flex align-items-center justify-content-between mb-3">
        <a href="{% url 'home' %}" class="text-decoration-none">&larr; Home</a>
        <div class="d-flex align-items-center gap-2">
            {% if user.avatar %}
            <img src="{{ user.avatar.url }}" class="rounded-circle" style="width:36px;height:36px;object-fit:cover;">
            {% else %}
            <div class="rounded-circle bg-secondary d-inline-flex align-items-center justify-content-center"
                style="width:36px;height:36px;color:#fff;">{{ user.username|first|upper }}</div>
            {% endif %}
        </div>
    </div>

    <!-- Card: Name + avatar -->
    <div class="card border-0 shadow-sm rounded-4 mb-4">
        <div class="card-body d-flex align-items-center gap-3">
            {% if user.avatar %}
            <img src="{{ user.avatar.url }}" class="rounded-circle" style="width:64px;height:64px;object-fit:cover;">
            {% else %}
            <div class="rounded-circle bg-secondary d-inline-flex align-items-center justify-content-center"
                style="width:64px;height:64px;color:#fff;">{{ user.username|first|upper }}</div>
            {% endif %}
            <div class="flex-grow-1">
                <div class="fw-semibold">Name</div>
                <div class="text-muted">{{ user.get_full_name|default:user.username }}</div>
            </div>
            <a class="btn btn-light border" href="{% url 'edit_profile' %}" title="Edit">‚úèÔ∏è</a>
        </div>
    </div>

    <!-- Contact -->
    <h6 class="text-uppercase text-muted mb-2">Contact</h6>
    <div class="card border-0 shadow-sm rounded-4 mb-4">
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" class="vstack gap-3">
                {% csrf_token %}
                {{ form.non_field_errors }}

                <div>
                    <div class="text-muted small mb-1">Main email</div>
                    {{ form.email }} <div class="text-danger small">{{ form.email.errors }}</div>
                </div>

                <div>
                    <div class="text-muted small mb-1">First name / Last name</div>
                    <div class="d-flex gap-2">
                        {{ form.first_name }} {{ form.last_name }}
                    </div>
                    <div class="text-danger small">{{ form.first_name.errors }} {{ form.last_name.errors }}</div>
                </div>

                <div>
                    <div class="text-muted small mb-1">Birthday</div>
                    {{ form.birth_date }} <div class="text-danger small">{{ form.birth_date.errors }}</div>
                </div>

                <div>
                    <div class="text-muted small mb-1">Bio</div>
                    {{ form.bio }} <div class="text-danger small">{{ form.bio.errors }}</div>
                </div>

                <div>
                    <div class="text-muted small mb-1">Avatar</div>
                    {{ form.avatar }} <div class="text-danger small">{{ form.avatar.errors }}</div>
                </div>

                <div class="d-flex justify-content-end">
                    <button class="btn btn-dark" type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Data management -->
    <h6 class="text-uppercase text-muted mb-2">Data Management</h6>
    <div class="card border-0 shadow-sm rounded-4 mb-4">
        <div class="list-group list-group-flush">
            <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                href="{% url 'password_reset' %}">
                <span>Reset password</span> <span>üîê</span>
            </a>

            <form class="list-group-item d-flex justify-content-between align-items-center m-0" method="post"
                action="{% url 'deactivate_sessions' %}">
                {% csrf_token %}
                <span>Deactivate active sessions</span>
                <button class="btn btn-sm btn-outline-secondary" type="submit">Run</button>
            </form>

            <form class="list-group-item d-flex justify-content-between align-items-center m-0" method="post"
                action="{% url 'delete_account' %}">
                {% csrf_token %}
                <span class="text-danger">Delete account</span>
                <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
            </form>
        </div>
    </div>

</div>
{% endblock %}