{% extends "base.html" %}
{% load widget_tweaks %}
{% block title %}Settings ¬∑ NEPTONE{% endblock %}
{% block content %}
<div class="row g-4">
  <div class="col-12 col-lg-8">
    <div class="card-np p-4 mb-4">
      <h2 class="h5 mb-3">–ü—Ä–æ—Ñ–∏–ª—å</h2>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="action" value="save_profile">
        {{ form.non_field_errors }}

        <div class="mb-2">
          <label class="form-label">Email</label>
          {{ form.email|add_class:"input-np" }} <div class="text-danger small">{{ form.email.errors }}</div>
        </div>

        <div class="grid-2 mb-2">
          <div>
            <label class="form-label">–ò–º—è</label>
            {{ form.first_name|add_class:"input-np" }}
          </div>
          <div>
            <label class="form-label">–§–∞–º–∏–ª–∏—è</label>
            {{ form.last_name|add_class:"input-np" }}
          </div>
          <div class="text-danger small">{{ form.first_name.errors }} {{ form.last_name.errors }}</div>
        </div>

        <div class="mb-2">
          <label class="form-label">–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è</label>
          {{ form.birth_date|add_class:"input-np" }} <div class="text-danger small">{{ form.birth_date.errors }}</div>
        </div>

        <div class="mb-2">
          <label class="form-label">–ë–∏–æ</label>
          {{ form.bio|add_class:"input-np" }} <div class="text-danger small">{{ form.bio.errors }}</div>
        </div>

        <div class="mb-3">
          <label class="form-label">–ê–≤–∞—Ç–∞—Ä</label>
          {{ form.avatar }} <div class="text-danger small">{{ form.avatar.errors }}</div>
        </div>

        <button class="btn-np primary" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </form>
    </div>

    <div class="card-np p-4 mb-4">
      <h2 class="h5 mb-3">–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)</h2>
    
      {% if request.user.otp_enabled %}
        <p>2FA –≤–∫–ª—é—á–µ–Ω–∞ ‚úÖ</p>
        <form method="post" action="{% url 'settings_2fa_disable' %}">
          {% csrf_token %}
          <button class="btn btn-sm btn-outline-danger" type="submit">–û—Ç–∫–ª—é—á–∏—Ç—å 2FA</button>
        </form>
      {% else %}
        <p>2FA –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞</p>
        <a class="btn-np primary" href="{% url 'settings_2fa_setup' %}">–ü–æ–¥–∫–ª—é—á–∏—Ç—å 2FA</a>
      {% endif %}
    </div>

    <div class="card-np p-4 mb-4" id="upload">
      <h2 class="h5 mb-3">Upload —Ç—Ä–µ–∫–∞</h2>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="action" value="upload_track">
        {{ upload_form.non_field_errors }}

        <div class="mb-2">
          <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
          {{ upload_form.title|add_class:"input-np" }} <div class="text-danger small">{{ upload_form.title.errors }}
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">–ê—É–¥–∏–æ</label>
          {{ upload_form.audio }} <div class="text-danger small">{{ upload_form.audio.errors }}</div>
        </div>
        <div class="mb-2">
          <label class="form-label">–û–±–ª–æ–∂–∫–∞ (–æ–ø—Ü.)</label>
          {{ upload_form.cover }} <div class="text-danger small">{{ upload_form.cover.errors }}</div>
        </div>
        <div class="form-check mb-3">
          {{ upload_form.is_public }}
          <label class="form-check-label">–ü—É–±–ª–∏—á–Ω—ã–π</label>
        </div>

        <button class="btn-np primary" type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
      </form>
      <div class="form-help mt-2">–î–æ 50 –ú–ë. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–≤–µ–ª–∏—á—å client_max_body_size –≤ nginx.</div>
    </div>

    <div class="card-np">
      <div class="list-group list-group-flush">
        <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          href="{% url 'password_reset' %}">
          <span>–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å</span> <span>üîê</span>
        </a>

        <form class="list-group-item d-flex justify-content-between align-items-center m-0" method="post"
          action="{% url 'deactivate_sessions' %}">
          {% csrf_token %}
          <span>–†–∞–∑–ª–æ–≥–∏–Ω–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏</span>
          <button class="btn btn-sm btn-outline-secondary" type="submit">Run</button>
        </form>

        <form class="list-group-item d-flex justify-content-between align-items-center m-0" method="post"
          action="{% url 'delete_account' %}">
          {% csrf_token %}
          <span class="text-danger">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
          <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}